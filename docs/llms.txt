# mcp-data-platform

> MCP server for AI-assisted data exploration. DataHub semantic layer with optional Trino and S3. Cross-injection automatically enriches query results with business context: owners, tags, quality scores, deprecation warnings. Implements fail-closed security with OIDC/API key authentication, TLS for HTTP transport, and prompt injection protection.

## Concepts

- [The Data Stack](concepts/components.md): Why DataHub, Trino, and S3. What each component brings, why they were chosen, and how cross-injection makes them greater than the sum of parts.

## Documentation

- [Home](index.md): Introduction, quick start, and key features
- [Server Overview](server/overview.md): What the platform does, architecture, request flow
- [Installation](server/installation.md): Install via go install, Homebrew, Docker, or from source
- [Configuration](server/configuration.md): YAML configuration with environment variable expansion, config versioning (apiVersion field, version lifecycle, migrate-config CLI), config store options (file vs database mode), tool visibility filtering (allow/deny patterns for tools/list token reduction), tool description overrides (built-in and custom per-tool description replacement in tools/list), workflow gating (session-aware enforcement that agents call DataHub discovery before Trino queries, with escalation), resource templates, progress notifications, client logging, elicitation (cost estimation, PII consent), icons (tool/resource/prompt visual metadata), admin API and portal, database, audit, and session configuration
- [Operating Modes](server/operating-modes.md): Three deployment modes â€” standalone (no database), full-config file + database, bootstrap + database config. Feature availability by mode, example configurations, decision guide
- [Admin Portal](server/admin-portal.md): Built-in web dashboard for monitoring and managing the platform. Configurable branding (portal_title, portal_logo with light/dark theme variants, dynamic favicon). Dashboard with activity timelines, performance percentiles, error monitoring. Tools overview with connection grid and tool inventory. Interactive tool explorer with semantic enrichment display. Searchable audit log with event detail drawer. Knowledge insight governance with approve/reject workflow and changeset tracking. Local dev with MSW mock data
- [Admin API](server/admin-api.md): REST endpoints for system info, config management, personas, auth keys, audit (events, stats, metrics/overview, metrics/enrichment, metrics/discovery), knowledge. Authentication, operating mode behavior, request/response reference. Interactive Swagger UI at `/api/v1/admin/docs/`
- [Tools](server/tools.md): All 27 tools from DataHub, Trino, and S3 toolkits
- [Multi-Provider](server/multi-provider.md): Connect multiple instances of each service
- [Audit Logging](server/audit.md): PostgreSQL-backed audit logging for tool calls. Schema, field reference (including enrichment_mode, enrichment_tokens_full, enrichment_tokens_dedup), parameter sanitization, retention, query examples (including enrichment token savings and discovery-before-query patterns), troubleshooting
- [Deployment](server/deployment.md): Docker Compose and Kubernetes/Helm deployment guides
- [Session Externalization](server/session-externalization.md): Externalize session state to PostgreSQL for zero-downtime restarts and horizontal scaling

## Cross-Injection

- [Overview](cross-injection/overview.md): How automatic context enrichment works between services
- [Trino to DataHub](cross-injection/trino-datahub.md): Trino results include DataHub metadata
- [DataHub to Trino](cross-injection/datahub-trino.md): DataHub results show query availability
- [S3 Enrichment](cross-injection/s3.md): S3 operations include semantic context
- [Lineage Inheritance](cross-injection/lineage.md): Automatic column metadata inheritance from upstream datasets via DataHub lineage
- [Session Dedup](cross-injection/overview.md#session-metadata-deduplication): Avoids repeating semantic metadata for previously-enriched tables within a session, saving LLM context tokens
- [Column Context Filtering](cross-injection/trino-datahub.md#column-level-enrichment): Limits column-level enrichment to columns referenced in the SQL query, reducing token usage for wide tables (default: enabled)
- [Schema Preview](cross-injection/datahub-trino.md#schema-preview): Adds bounded column-name+type preview to datahub_search query_context, eliminating intermediate datahub_get_schema calls (default: enabled, max 15 columns)

## Authentication & Security

- [Auth Overview](auth/overview.md): Fail-closed security model, stdio vs HTTP authentication
- [OIDC](auth/oidc.md): Keycloak, Auth0, Okta, Azure AD setup with required claims
- [API Keys](auth/api-keys.md): Service account authentication
- [OAuth Server](auth/oauth-server.md): Built-in OAuth 2.1 for Claude Desktop + Keycloak integration
- [Security Article](https://imti.co/mcp-defense/): MCP Defense - A Case Study in AI Security

## Personas

- [Overview](personas/overview.md): Role-based tool access control
- [Tool Filtering](personas/tool-filtering.md): Allow/deny patterns with wildcards. Distinction between persona-level filtering (security boundary) and global tool visibility (token optimization)
- [Role Mapping](personas/role-mapping.md): Map OIDC roles to personas

## Go Library

- [Library Overview](library/overview.md): Build custom MCP servers using the Go library
- [Quick Start](library/quickstart.md): Code examples for common patterns
- [Architecture](library/architecture.md): Package structure, MCP protocol middleware, provider interfaces
- [Extensibility](library/extensibility.md): Custom toolkits, providers, middleware

## Knowledge Capture

- [Overview](knowledge/overview.md): Tribal knowledge capture for data catalogs. capture_insight records domain knowledge during AI sessions; apply_knowledge provides admin review, synthesis, and DataHub write-back with changeset tracking and rollback. Insight categories, lifecycle states, insight sources (user, agent_discovery, enrichment_gap), governance workflow, configuration, persona integration, AI agent guidance prompt for both user-provided and agent-discovered insights
- [Governance Workflow](knowledge/governance.md): Active metadata management through human-in-the-loop curation. Bulk review, per-entity review, approve/reject actions, synthesize change proposals, apply changes to DataHub (update_description, add_tag, remove_tag, add_glossary_term, flag_quality_issue, add_documentation, add_curated_query), changeset tracking, rollback. Column-level targeting via column:<fieldPath>. Agent-driven curated query creation via query_sql/query_description fields. Complete end-to-end workflow example
- [Admin API](knowledge/admin-api.md): REST endpoints for managing insights and changesets. List/filter/get/update insights, approve/reject status transitions, insight statistics. List/get changesets, rollback. Authentication, error responses, database schema reference

## MCP Apps

- [Overview](mcpapps/overview.md): Interactive UI panels rendered inline in the MCP host. Built-in `platform-info` app embedded in the binary and auto-registers with zero config. Branding (brand_name, brand_url, logo_svg) via config. Custom apps still supported with assets_path.
- [Configuration](mcpapps/configuration.md): MCP Apps enabled by default. platform-info built-in (no assets_path needed). Branding overrides via config block. Custom app registration with assets_path, CSP settings, and config injection. Disable with `mcpapps.enabled: false`.
- [Development](mcpapps/development.md): Docker-based development with test harness. mcpapps-dev.yaml uses assets_path to override embedded HTML for live editing. Creating new apps, MCP Apps protocol.
- [Tutorial](mcpapps/tutorial.md): Step-by-step guide building a platform-info app. Covers MCP Apps protocol, message handling, tool result parsing, test harness workflow, dark mode support. Deployment section explains built-in vs custom-asset vs override modes.

## Examples

- [Examples Gallery](examples/index.md): Real-world configurations for enterprise governance, data democratization, and AI/ML workflows

## Reference

- [Tools API](reference/tools-api.md): Complete tool specifications with parameters and responses
- [Configuration](reference/configuration.md): Full YAML schema with all options
- [Providers](reference/providers.md): Semantic, query, and storage provider interfaces
- [Middleware](reference/middleware.md): Request processing chain including tool visibility middleware, description override middleware (built-in overrides for trino_query/trino_execute plus config-driven overrides), session-aware workflow gating (MCPRuleEnforcementMiddleware with SessionWorkflowTracker), icon injection middleware, client logging, progress notifications

## Support

- [Troubleshooting](support/troubleshooting.md): Common issues, error codes, debugging guide
